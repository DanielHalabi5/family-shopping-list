
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}
        

model User {
  id        String   @id @default(cuid())
  name      String
  email     String   @unique
  password  String
  familyId  String
  family    Family   @relation(fields: [familyId], references: [id])
   ownedFamily  Family?   @relation("FamilyOwner")
  ownedItems     ShoppingItem[]  @relation("OwnerItems")
 
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

   sentRequests   FamilyJoinRequest[] @relation("UserRequests")
}

model Family {
  id            String         @id @default(cuid())
  name          String

 ownerId    Int       @unique
  owner      User      @relation("FamilyOwner", fields: [ownerId], references: [id])

  members       User[]
  shoppingLists ShoppingList[]

 joinRequests FamilyJoinRequest[] @relation("FamilyRequests")

  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
}

model ShoppingList {
  id         String         @id @default(cuid())
  title      String          @default("Weekly Shopping List")
  startDate  DateTime       
  dueDate    DateTime       
  archived   Boolean          @default(false)
  familyId   String
  family     Family          @relation(fields: [familyId], references: [id])
  items      ShoppingItem[]
  createdAt  DateTime        @default(now())
  updatedAt  DateTime        @updatedAt
}

model ShoppingItem {
  id             String         @id @default(cuid())
  name           String
  description    String?
  status         ItemStatus      @default(INCLUDED)
  shoppingListId String
  shoppingList   ShoppingList    @relation(fields: [shoppingListId], references: [id])
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
}



model FamilyJoinRequest {
  id         Int      @id @default(autoincrement())
  user       User     @relation("UserRequests", fields: [userId], references: [id])
  userId     Int
  family     Family   @relation("FamilyRequests", fields: [familyId], references: [id])
  familyId   Int
  status     String   @default("PENDING") 
  createdAt  DateTime @default(now())
}

enum ItemStatus {
  INCLUDED
  SKIPPED
}