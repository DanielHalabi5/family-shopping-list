
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}
        

model User {
  id            String           @id @default(cuid())
  email         String           @unique
  name          String
  password      String


  familyId      String?
  family        Family?          @relation(fields: [familyId], references: [id])

  ownedFamily   Family?          @relation("FamilyOwner")

  ownedItems    ShoppingItem[]   @relation("OwnerItems")

  joinRequests  FamilyJoinRequest[]
}

model Family {
  id         String              @id @default(cuid())
  name       String
  ownerId    String              @unique
  owner      User                @relation("FamilyOwner", fields: [ownerId], references: [id])

  members    User[]
  lists      ShoppingList[]   
    items      ShoppingItem[]   
  requests   FamilyJoinRequest[]
  createdAt  DateTime            @default(now())
}

model ShoppingList {
  id         String         @id @default(cuid())
  title      String         @default("Weekly Shopping List")
  startDate  DateTime
  dueDate    DateTime
  archived   Boolean        @default(false)

  familyId   String
  family     Family         @relation(fields: [familyId], references: [id])

  items      ShoppingItem[] 
  createdAt  DateTime       @default(now())
  updatedAt  DateTime       @updatedAt
}

model ShoppingItem {
  id          String        @id @default(cuid())
  name        String
  quantity String?
  status      ItemStatus    @default(INCLUDED)

  familyId    String
  family      Family        @relation(fields: [familyId], references: [id])

  listId      String
  list        ShoppingList  @relation(fields: [listId], references: [id])

  ownerId     String
  owner       User          @relation("OwnerItems", fields: [ownerId], references: [id])

  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
}

model FamilyJoinRequest {
  id        String         @id @default(cuid())
  userId    String
  user      User           @relation(fields: [userId], references: [id])
  familyId  String
  family    Family         @relation(fields: [familyId], references: [id])
  status    RequestStatus  @default(PENDING)
  createdAt DateTime       @default(now())
}

enum ItemStatus {
  INCLUDED
  SKIPPED
  PURCHASED
}
enum RequestStatus {
  PENDING
  APPROVED
  REJECTED
}